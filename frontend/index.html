<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMBEDDLE</title>
    <meta name="description" content="Embeddle - A multiplayer word deduction game using AI embeddings. Encrypt your word, probe enemies, eliminate targets.">
    <meta name="theme-color" content="#000000">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Open Graph / Social -->
    <meta property="og:title" content="EMBEDDLE">
    <meta property="og:description" content="A multiplayer word deduction game using AI embeddings">
    <meta property="og:image" content="https://embeddle.vercel.app/og-image.png">
    <meta property="og:url" content="https://embeddle.vercel.app">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Use absolute URLs so /game/:code routes still load assets -->
    <link rel="stylesheet" href="/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Login Box -->
    <div id="login-box" class="login-box">
        <input type="text" id="login-name" placeholder="ENTER CALLSIGN..." maxlength="20">
        <span class="login-or">or</span>
        <button id="google-login-btn" class="btn btn-google" title="Sign in with Google">
            <svg width="18" height="18" viewBox="0 0 24 24">
                <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
        </button>
    </div>
    <div id="logged-in-box" class="logged-in-box hidden">
        <button id="topbar-toggle" class="topbar-toggle" title="Toggle menu" aria-label="Toggle menu" aria-expanded="false">
            <span class="topbar-toggle-icon">‚ñº</span>
        </button>
        <div class="topbar-content">
            <img id="user-avatar" class="user-avatar hidden" src="" alt="">
            <span id="logged-in-name">OPERATIVE</span>
            <button id="daily-btn" class="btn btn-ghost btn-tiny" title="Daily Ops">üéØ</button>
            <button id="cosmetics-btn" class="btn btn-ghost btn-tiny" title="Cosmetics">üé®</button>
            <button id="chat-btn" class="btn btn-ghost btn-tiny" title="Chat">üí¨<span id="chat-unread-dot" class="unread-dot hidden"></span></button>
            <button id="options-btn" class="btn btn-ghost btn-tiny" title="Options">‚öôÔ∏è</button>
        </div>
    </div>

    <!-- Cosmetics Panel -->
    <div id="cosmetics-panel" class="drawer-panel cosmetics-panel">
        <div class="cosmetics-header">
            <h2>üé® COSMETICS</h2>
            <button id="close-cosmetics-btn" class="btn btn-ghost btn-tiny">√ó</button>
        </div>
        <div class="cosmetics-tools">
            <div class="cosmetics-preview-row">
                <div id="cosmetics-preview-card" class="player-card cosmetics-preview-card" data-player-id="cosmetics_preview">
                    <div id="cosmetics-preview-name" class="name">YOU</div>
                    <div class="status alive">Preview</div>
                </div>
                <div class="cosmetics-test-buttons">
                    <button id="cosmetics-test-turn" class="btn btn-ghost btn-small" type="button">TOGGLE TURN</button>
                    <button id="cosmetics-test-guess" class="btn btn-ghost btn-small" type="button">TEST GUESS</button>
                    <button id="cosmetics-test-elim" class="btn btn-ghost btn-small" type="button">TEST ELIM</button>
                    <button id="cosmetics-test-victory" class="btn btn-ghost btn-small" type="button">TEST VICTORY</button>
                </div>
            </div>
            <div id="cosmetics-guess-form" class="cosmetics-guess-form" aria-label="Guess effect preview">
                <span class="cosmetics-guess-text">SUBMIT</span>
            </div>
            <div id="cosmetics-victory-container" class="cosmetics-victory-preview" aria-label="Victory effect preview"></div>
        </div>
        <div class="cosmetics-content">
            <!-- Content populated by JS -->
        </div>
    </div>

    <!-- Daily Ops Panel -->
    <div id="daily-panel" class="drawer-panel daily-panel">
        <div class="daily-header">
            <h2>üéØ DAILY OPS</h2>
            <button id="close-daily-btn" class="btn btn-ghost btn-tiny">√ó</button>
        </div>
        <div class="daily-content">
            <div class="daily-balance">
                <span>CREDITS:</span>
                <span id="daily-credits">0</span>
            </div>

            <h3 class="daily-section-title">DAILY STREAK</h3>
            <div id="daily-streak" class="daily-streak">
                <div class="streak-display">
                    <span class="streak-icon">üî•</span>
                    <span class="streak-count">0</span>
                </div>
            </div>

            <h3 class="daily-section-title">DAILY QUESTS</h3>
            <div id="daily-quests" class="daily-quests">
                <div class="daily-empty">Loading...</div>
            </div>

            <h3 class="daily-section-title">WEEKLY QUESTS</h3>
            <div id="weekly-quests" class="daily-quests weekly-quests">
                <div class="daily-empty">Loading...</div>
            </div>

            <h3 class="daily-section-title">SHOP</h3>
            <div id="daily-shop" class="daily-shop">
                <div class="daily-empty">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Options Panel -->
    <div id="options-panel" class="drawer-panel options-panel">
        <div class="options-header">
            <h2>‚öôÔ∏è OPTIONS</h2>
            <button id="close-options-btn" class="btn btn-ghost btn-tiny">√ó</button>
        </div>
        <div class="options-content">
            <label class="option-row">
                <input type="checkbox" id="opt-chat-enabled">
                <span>Text chat</span>
            </label>
            <div class="option-row option-row-slider">
                <span>üéµ Music</span>
                <div class="volume-control">
                    <input type="range" id="opt-music-volume" min="0" max="100" value="12">
                    <span class="volume-value" id="music-volume-display">12%</span>
                </div>
            </div>
            <div class="option-row option-row-slider">
                <span>üîä Sound Effects</span>
                <div class="volume-control">
                    <input type="range" id="opt-sfx-volume" min="0" max="100" value="50">
                    <span class="volume-value" id="sfx-volume-display">50%</span>
                </div>
            </div>
            <label class="option-row">
                <input type="checkbox" id="opt-turn-notifications">
                <span>Turn notifications</span>
            </label>
            <hr class="option-divider">
            <label class="option-row">
                <input type="checkbox" id="opt-nerd-mode">
                <span>Nerd mode (show raw cosine similarity)</span>
            </label>
            <hr class="option-divider">
            <button id="ml-info-btn" class="btn btn-secondary btn-small" style="margin-top: 1rem; width: 100%;">üìä How Embeddings Work</button>
            
            <hr class="option-divider">
            <div class="rank-info-section">
                <h3 class="rank-info-title">üèÜ Ranked Tiers</h3>
                <p class="rank-info-desc">Climb the ranks by winning ranked matches! New players have higher rating volatility for faster calibration.</p>
                
                <div class="rank-tier-table">
                    <div class="rank-tier-row">
                        <span class="rank-badge rank-master">MASTER</span>
                        <span class="rank-tier-range">2000+</span>
                    </div>
                    <div class="rank-tier-row">
                        <span class="rank-badge rank-diamond">DIAMOND</span>
                        <span class="rank-tier-range">1800 - 1999</span>
                    </div>
                    <div class="rank-tier-row">
                        <span class="rank-badge rank-platinum">PLATINUM</span>
                        <span class="rank-tier-range">1600 - 1799</span>
                    </div>
                    <div class="rank-tier-row">
                        <span class="rank-badge rank-gold">GOLD</span>
                        <span class="rank-tier-range">1400 - 1599</span>
                    </div>
                    <div class="rank-tier-row">
                        <span class="rank-badge rank-silver">SILVER</span>
                        <span class="rank-tier-range">1200 - 1399</span>
                    </div>
                    <div class="rank-tier-row">
                        <span class="rank-badge rank-bronze">BRONZE</span>
                        <span class="rank-tier-range">1000 - 1199</span>
                    </div>
                    <div class="rank-tier-row">
                        <span class="rank-badge rank-unranked">UNRANKED</span>
                        <span class="rank-tier-range">Below 1000</span>
                    </div>
                </div>
                
                <div class="rank-calibration-info">
                    <h4>Rating Calibration</h4>
                    <ul>
                        <li><strong>Placement (0-4 games):</strong> High volatility for fast calibration</li>
                        <li><strong>Provisional (5-19 games):</strong> Medium volatility as rating stabilizes</li>
                        <li><strong>Established (20+ games):</strong> Normal volatility for stable ratings</li>
                    </ul>
                </div>
            </div>
            
            <hr class="option-divider">
            <div class="support-section">
                <h3 class="support-title">‚òï Support Embeddle</h3>
                <p class="support-desc">Embeddle is free to play! Your support helps cover AI API costs and keeps the game running.</p>
                
                <div class="premium-perks">
                    <h4>üéÅ Supporter Exclusive Cosmetics</h4>
                    <div class="premium-items-grid">
                        <div class="premium-item">
                            <span class="premium-item-icon">üåà</span>
                            <span class="premium-item-name">Holographic Border</span>
                        </div>
                        <div class="premium-item">
                            <span class="premium-item-icon">‚ú®</span>
                            <span class="premium-item-name">Rainbow Name</span>
                        </div>
                        <div class="premium-item">
                            <span class="premium-item-icon">üî•</span>
                            <span class="premium-item-name">Fire Ring Turn</span>
                        </div>
                        <div class="premium-item">
                            <span class="premium-item-icon">üí´</span>
                            <span class="premium-item-name">Disintegrate Effect</span>
                        </div>
                        <div class="premium-item">
                            <span class="premium-item-icon">üåå</span>
                            <span class="premium-item-name">Aurora Victory</span>
                        </div>
                        <div class="premium-item">
                            <span class="premium-item-icon">‚≠ê</span>
                            <span class="premium-item-name">Starfield Overlay</span>
                        </div>
                        <div class="premium-item">
                            <span class="premium-item-icon">‚òï</span>
                            <span class="premium-item-name">Supporter Badge</span>
                        </div>
                        <div class="premium-item">
                            <span class="premium-item-icon">üåÄ</span>
                            <span class="premium-item-name">Void Walker Title</span>
                        </div>
                    </div>
                    <p class="premium-note">+ Gold Rush matrix, Aurora background, Fireworks theme, and more!</p>
                </div>
                
                <a href="https://ko-fi.com/embeddle" target="_blank" class="btn btn-primary support-btn">‚òï Support on Ko-fi</a>
                <p class="support-note">One-time donation of any amount unlocks ALL premium cosmetics forever!</p>
            </div>
        </div>
    </div>

    <!-- ML Info Modal -->
    <div id="ml-info-modal" class="modal-overlay closable-modal">
        <div class="modal-backdrop" data-close="true"></div>
        <div class="modal ml-info-modal">
            <div class="ml-info-header">
                <h2>üß† How EMBEDDLE Works</h2>
                <button id="close-ml-info-btn" class="btn btn-ghost btn-tiny">√ó</button>
            </div>
            <div class="ml-info-content">
                <h3>Word Embeddings</h3>
                <p>EMBEDDLE uses <strong>word embeddings</strong> - vectors in high-dimensional space that capture semantic meaning. Words with similar meanings are closer together in this space.</p>
                
                <h3>Cosine Similarity</h3>
                <p>We measure how "close" two words are using <strong>cosine similarity</strong> - the cosine of the angle between their vectors. Raw values range from -1 (opposite) to 1 (identical).</p>
                
                <div class="ml-formula">
                    <code>cosine(A, B) = (A ¬∑ B) / (||A|| √ó ||B||)</code>
                </div>
                
                <h3>Display Transformation</h3>
                <p>Raw cosine similarity values tend to cluster between 20-60%, making them hard to interpret. We apply a <strong>sigmoid-like transformation</strong> to spread values more intuitively across the 0-100% range:</p>
                
                <div class="ml-formula">
                    <code>display(s) = s<sup>n</sup> / (s<sup>n</sup> + (c¬∑(1-s))<sup>n</sup>)</code>
                    <br><small>where c = m/(1-m), n = 3, m = 0.36</small>
                </div>
                
                <p>This makes low similarities appear lower and high similarities appear higher, while keeping the midpoint around 36% raw = 50% displayed.</p>
                
                <p><strong>Nerd mode</strong> (in options) shows the original raw cosine similarity alongside the transformed display value.</p>
                
                <h3>The Game</h3>
                <p>Each guess reveals how similar it is to each player's secret word. <strong>Guessing a player's exact word eliminates them!</strong></p>
                
                <ul class="ml-tips">
                    <li><strong>Strategy:</strong> Use words semantically close to opponents' likely words to deduce their secret</li>
                    <li><strong>Defense:</strong> Choose obscure words with few semantic neighbors</li>
                    <li><strong>Pro tip:</strong> Related words often have 30-50% raw similarity (displayed as ~20-60%)</li>
                </ul>
                
                <h3>Model</h3>
                <p>We use OpenAI's <strong>text-embedding-3-large</strong> model, providing high-quality semantic embeddings for robust word similarity comparisons.</p>
            </div>
        </div>
    </div>

    <!-- Player Profile Modal -->
    <div id="profile-modal" class="modal-overlay closable-modal">
        <div class="modal-backdrop" data-close="true"></div>
        <div class="modal profile-modal">
            <div class="profile-banner">
                <div class="profile-banner-overlay"></div>
                <button id="close-profile-btn" class="btn btn-ghost btn-tiny profile-close-btn">√ó</button>
            </div>
            <div class="profile-header">
                <div class="profile-avatar-wrapper">
                    <img id="profile-avatar" class="profile-avatar hidden" src="" alt="">
                    <span id="profile-avatar-placeholder" class="profile-avatar-placeholder">üë§</span>
                    <span id="profile-avatar-emoji" class="profile-avatar-emoji hidden"></span>
                    <button id="edit-avatar-btn" class="edit-avatar-btn hidden" title="Change avatar">‚úèÔ∏è</button>
                </div>
                <div class="profile-title-wrapper">
                    <div class="profile-name-row">
                        <h2 id="profile-name">Player</h2>
                        <span id="profile-badge" class="profile-badge"></span>
                    </div>
                    <span id="profile-joined" class="profile-joined"></span>
                </div>
            </div>
            <div class="profile-content">
                <div class="profile-section">
                    <h3 class="profile-section-title">// CASUAL STATS</h3>
                    <div class="profile-stats-grid">
                        <div class="profile-stat">
                            <span class="profile-stat-value" id="profile-wins">0</span>
                            <span class="profile-stat-label">Wins</span>
                        </div>
                        <div class="profile-stat">
                            <span class="profile-stat-value" id="profile-games">0</span>
                            <span class="profile-stat-label">Games</span>
                        </div>
                        <div class="profile-stat">
                            <span class="profile-stat-value" id="profile-winrate">0%</span>
                            <span class="profile-stat-label">Win Rate</span>
                        </div>
                        <div class="profile-stat">
                            <span class="profile-stat-value" id="profile-elims">0</span>
                            <span class="profile-stat-label">Eliminations</span>
                        </div>
                        <div class="profile-stat">
                            <span class="profile-stat-value" id="profile-times-eliminated">0</span>
                            <span class="profile-stat-label">Deaths</span>
                        </div>
                        <div class="profile-stat">
                            <span class="profile-stat-value" id="profile-streak">0</span>
                            <span class="profile-stat-label">Best Streak</span>
                        </div>
                    </div>
                </div>
                <div id="profile-ranked-section" class="profile-section profile-ranked-section hidden">
                    <h3 class="profile-section-title">// RANKED</h3>
                    <div id="profile-rank-tier" class="profile-rank-tier"></div>
                    <div class="profile-stats-grid profile-ranked-grid">
                        <div class="profile-stat">
                            <span class="profile-stat-value" id="profile-mmr">1000</span>
                            <span class="profile-stat-label">MMR</span>
                        </div>
                        <div class="profile-stat">
                            <span class="profile-stat-value" id="profile-peak-mmr">1000</span>
                            <span class="profile-stat-label">Peak</span>
                        </div>
                        <div class="profile-stat">
                            <span class="profile-stat-value" id="profile-ranked-record">0-0</span>
                            <span class="profile-stat-label">W-L</span>
                        </div>
                    </div>
                </div>
                <div class="profile-actions">
                    <button id="share-profile-btn" class="btn btn-secondary btn-small">
                        <span class="share-icon">üîó</span> SHARE PROFILE
                    </button>
                    <button id="profile-logout-btn" class="btn btn-danger btn-small">
                        LOGOUT
                    </button>
                </div>
                <div id="profile-loading" class="profile-loading">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Avatar Picker Modal -->
    <div id="avatar-picker-modal" class="modal-overlay closable-modal">
        <div class="modal-backdrop" data-close="true"></div>
        <div class="modal avatar-picker-modal">
            <div class="modal-header">
                <h2>Choose Your Avatar</h2>
                <button id="close-avatar-picker-btn" class="btn btn-ghost btn-tiny">√ó</button>
            </div>
            <div class="avatar-picker-content">
                <div id="avatar-picker-grid" class="avatar-picker-grid">
                    <!-- Avatars will be populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Panel -->
    <div id="chat-panel" class="drawer-panel chat-panel">
        <div class="chat-header">
            <h2>üí¨ CHAT</h2>
            <button id="close-chat-btn" class="btn btn-ghost btn-tiny">√ó</button>
        </div>
        <div class="chat-content">
            <div id="chat-log" class="chat-log" aria-label="Chat log"></div>
            <form id="chat-form" class="chat-form" autocomplete="off">
                <input type="text" id="chat-input" maxlength="200" placeholder="Type message..." autocomplete="off">
                <button type="submit" class="btn btn-small btn-secondary">SEND</button>
            </form>
            <p id="chat-hint" class="chat-hint">Join a match to chat.</p>
        </div>
    </div>

    <div class="matrix-bg" id="matrix-bg"></div>
    <div class="container">
        <header>
            <h1>&lt;EMBEDDLE/&gt;</h1>
            <p class="tagline">// crack them before they crack you</p>
        </header>

        <!-- Home Screen -->
        <div id="home-screen" class="screen active home-screen">
            <div class="card hero-card">
                <div class="hero-content">
                    <h2>INITIALISE BREACH</h2>
                    <p class="hero-description">Encrypt your codeword. Probe enemy systems. Decode their secrets. Eliminate targets. Last operative standing wins.</p>
                </div>
                
                <!-- Compact Stats Bar (shown when logged in) -->
                <div id="home-stats-bar" class="home-stats-bar hidden">
                    <div class="stat-item stat-streak" title="Daily login streak">
                        <span class="stat-icon">üî•</span>
                        <span id="stats-streak-count" class="stat-value">0</span>
                        <span class="stat-label">days</span>
                    </div>
                    <div class="stat-item stat-credits" title="Credits">
                        <span class="stat-icon">üí∞</span>
                        <span id="stats-credits" class="stat-value">0</span>
                        <span class="stat-label">credits</span>
                    </div>
                    <div class="stat-item stat-rank" title="Your rank">
                        <span class="stat-icon">üèÜ</span>
                        <span id="stats-rank" class="stat-value">‚Äî</span>
                    </div>
                </div>
                
                <div class="home-actions">
                    <div class="home-actions-primary">
                        <button id="quickplay-btn" class="btn btn-primary btn-large btn-block home-action">
                            <span class="btn-text">&gt; QUICK_PLAY</span>
                            <span id="quickplay-queue-count" class="queue-count hidden">0 in queue</span>
                        </button>
                        <button id="ranked-btn" class="btn btn-rank btn-large btn-block home-action">
                            <span class="btn-text">&gt; RANKED</span>
                            <span id="ranked-queue-count" class="queue-count hidden">0 in queue</span>
                        </button>
                    </div>
                    <div class="home-actions-secondary">
                        <button id="create-lobby-btn" class="btn btn-secondary btn-block home-action">&gt; CUSTOM_LOBBY</button>
                        <button id="singleplayer-btn" class="btn btn-secondary btn-block home-action">&gt; SOLO_MISSION</button>
                    </div>
                    <div class="home-join-row">
                        <input type="text" id="join-code-input" maxlength="6" placeholder="SERVER_ID">
                        <button id="join-code-btn" class="btn btn-small btn-secondary">JOIN</button>
                    </div>
                    <div class="home-links-row">
                        <span id="ranked-signin-note" class="home-note">Ranked requires Google sign-in + 5 casual games.</span>
                    </div>
                    <div class="home-support-row">
                        <a href="https://ko-fi.com/embeddle" target="_blank" rel="noopener" class="home-support-link">
                            ‚òï Enjoying Embeddle? Support development
                        </a>
                    </div>
                </div>
            </div>

            <!-- Middle section: Sessions and Lobbies -->
            <div class="home-columns">
                <div class="home-column home-column-left">
                    <!-- Recent / Active Games -->
                    <div class="card card-compact lobbies-card">
                        <h3>// YOUR_SESSIONS</h3>
                        <div id="recent-games" class="open-lobbies">
                            <p class="loading-lobbies">No recent games.</p>
                        </div>
                    </div>

                    <!-- Open Lobbies Section -->
                    <div class="card card-compact lobbies-card">
                        <h3>// ACTIVE_SERVERS</h3>
                        <div id="open-lobbies" class="open-lobbies">
                            <p class="loading-lobbies">Scanning network...</p>
                        </div>
                        <button id="refresh-lobbies-btn" class="btn btn-ghost btn-small">‚Üª RESCAN</button>
                    </div>

                    <!-- Spectate Section -->
                    <div class="card card-compact lobbies-card">
                        <h3>// LIVE_MATCHES</h3>
                        <div id="spectate-games" class="open-lobbies">
                            <p class="loading-lobbies">Scanning network...</p>
                        </div>
                        <button id="refresh-spectate-btn" class="btn btn-ghost btn-small">‚Üª RESCAN</button>
                    </div>
                </div>

                <!-- Right Column: Mini Leaderboard and Stats -->
                <div class="home-column home-column-right">
                    <!-- Mini Leaderboard -->
                    <div class="card card-compact lobbies-card mini-leaderboard-card">
                        <h3>// TOP_OPERATIVES</h3>
                        <div id="mini-leaderboard" class="mini-leaderboard">
                            <p class="loading-lobbies">Loading...</p>
                        </div>
                        <button id="view-full-leaderboard-btn" class="btn btn-ghost btn-small">VIEW_ALL ‚Üí</button>
                    </div>

                    <!-- Your Stats Preview -->
                    <div id="home-your-stats" class="card card-compact lobbies-card your-stats-card hidden">
                        <h3>// YOUR_STATS</h3>
                        <div class="your-stats-grid">
                            <div class="your-stat">
                                <span class="your-stat-value" id="home-stat-games">0</span>
                                <span class="your-stat-label">Games</span>
                            </div>
                            <div class="your-stat">
                                <span class="your-stat-value" id="home-stat-wins">0</span>
                                <span class="your-stat-label">Wins</span>
                            </div>
                            <div class="your-stat">
                                <span class="your-stat-value" id="home-stat-elims">0</span>
                                <span class="your-stat-label">Elims</span>
                            </div>
                            <div class="your-stat">
                                <span class="your-stat-value" id="home-stat-mmr">‚Äî</span>
                                <span class="your-stat-label">MMR</span>
                            </div>
                        </div>
                    </div>

                    <!-- Watch Replay -->
                    <div class="card card-compact lobbies-card replay-card">
                        <h3>// WATCH_REPLAY</h3>
                        <div class="home-replay-row">
                            <input type="text" id="home-replay-input" placeholder="Paste replay code..." class="replay-code-input">
                            <button id="home-replay-btn" class="btn btn-small btn-secondary">üé¨</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Protocol Section -->
            <div class="protocol-section">
                <h3 class="protocol-header" id="rules-toggle">
                    // PROTOCOL
                    <span class="rules-toggle-icon">‚ñº</span>
                </h3>
                <div id="rules-content" class="protocol-cards collapsed">
                    <div class="card card-compact protocol-card">
                        <span class="rule-number">01</span>
                        <strong>ENCRYPT</strong>
                        <p>Each operative picks a secret word from a shared theme</p>
                    </div>
                    <div class="card card-compact protocol-card">
                        <span class="rule-number">02</span>
                        <strong>PROBE</strong>
                        <p>On your turn, guess a word. Everyone sees how similar it is to each player's secret word</p>
                    </div>
                    <div class="card card-compact protocol-card">
                        <span class="rule-number">03</span>
                        <strong>ANALYSE</strong>
                        <p>Use similarity scores to deduce enemy words while hiding your own</p>
                    </div>
                    <div class="card card-compact protocol-card">
                        <span class="rule-number">04</span>
                        <strong>ELIMINATE</strong>
                        <p>Guess someone's exact word to eliminate them. Last one standing wins</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Queue Screen (Matchmaking) -->
        <div id="queue-screen" class="screen">
            <div class="card queue-card">
                <h2>// SEARCHING FOR OPERATIVES</h2>
                
                <div class="queue-animation">
                    <div class="queue-radar">
                        <div class="radar-ring radar-ring-1"></div>
                        <div class="radar-ring radar-ring-2"></div>
                        <div class="radar-ring radar-ring-3"></div>
                        <div class="radar-sweep"></div>
                        <div class="radar-center"></div>
                    </div>
                </div>
                
                <div class="queue-info">
                    <div class="queue-mode-display">
                        <span class="queue-label">MODE:</span>
                        <span id="queue-mode" class="queue-value">QUICK PLAY</span>
                    </div>
                    <div class="queue-players-display">
                        <span class="queue-label">OPERATIVES FOUND:</span>
                        <span id="queue-players" class="queue-value">0</span>
                        <span class="queue-value">/4</span>
                    </div>
                    <div class="queue-timer-display">
                        <span class="queue-label">TIME IN QUEUE:</span>
                        <span id="queue-timer" class="queue-value">0:00</span>
                    </div>
                    <div id="queue-mmr-display" class="queue-mmr-display hidden">
                        <span class="queue-label">SEARCH RANGE:</span>
                        <span id="queue-mmr-range" class="queue-value">+/- 100 MMR</span>
                    </div>
                </div>
                
                <div class="queue-status-text">
                    <p id="queue-status-message">Scanning for available operatives...</p>
                </div>
                
                <button id="cancel-queue-btn" class="btn btn-ghost">&lt; CANCEL</button>
            </div>
        </div>

        <!-- Leaderboard Screen -->
        <div id="leaderboard-screen" class="screen">
            <div class="card">
                <h2>// LEADERBOARDS</h2>
                <div class="button-group">
                    <button id="lb-tab-casual" class="btn btn-secondary btn-small">CASUAL</button>
                    <button id="lb-tab-ranked" class="btn btn-secondary btn-small">RANKED</button>
                </div>

                <div id="lb-casual-panel" class="leaderboard-panel">
                    <div class="button-group">
                        <button id="lb-casual-alltime" class="btn btn-ghost btn-small">ALL_TIME</button>
                        <button id="lb-casual-weekly" class="btn btn-ghost btn-small">WEEKLY</button>
                    </div>
                    <div id="casual-leaderboard-table" class="leaderboard-table-container">
                        <div class="leaderboard-empty">Loading...</div>
                    </div>
                </div>

                <div id="lb-ranked-panel" class="leaderboard-panel hidden">
                    <div id="ranked-leaderboard-table" class="leaderboard-table-container">
                        <div class="leaderboard-empty">Loading...</div>
                    </div>
                </div>

                <div class="button-group">
                    <button id="lb-back-btn" class="btn btn-ghost">&lt; BACK</button>
                </div>
            </div>
        </div>

        <!-- Join Screen (for word selection) -->
        <div id="join-screen" class="screen">
            <div class="card">
                <h2 id="join-screen-title">// CONNECT</h2>
                <div id="theme-display" class="theme-display hidden">
                    <div class="theme-header">
                        <span>DATABASE:</span>
                        <span id="theme-name" class="theme-name">Loading...</span>
                    </div>
                    <div class="theme-words-container">
                        <p class="theme-words-label">Available codewords (select one):</p>
                        <div id="theme-words" class="theme-words">
                            <!-- Words will be added here -->
                        </div>
                    </div>
                </div>
                <form id="join-form">
                    <div class="form-group" id="game-code-group">
                        <label for="game-code">SERVER_ID</label>
                        <input type="text" id="game-code" maxlength="6" placeholder="XXXXXX" required>
                    </div>
                    <div class="form-group">
                        <label for="player-name">CALLSIGN</label>
                        <input type="text" id="player-name" maxlength="20" placeholder="Enter callsign..." required>
                    </div>
                    <div class="form-group">
                        <label for="secret-word">CODEWORD</label>
                        <input type="text" id="secret-word" maxlength="30" placeholder="Select from database above..." required>
                        <small>This is your encrypted identity</small>
                    </div>
                    <div class="button-group">
                        <button type="submit" id="join-submit-btn" class="btn btn-primary">&gt; CONNECT</button>
                        <button type="button" id="back-home-btn" class="btn btn-ghost">&lt; ABORT</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Lobby Screen -->
        <div id="lobby-screen" class="screen">
            <div class="card">
                <h2>// SERVER_LOBBY</h2>
                <div class="game-code-display">
                    <span>ACCESS_CODE:</span>
                    <span id="lobby-code" class="code">------</span>
                    <button id="copy-code-btn" class="btn btn-small">COPY</button>
                    <span id="lobby-mode-badge" class="mode-badge casual">CASUAL</span>
                    <span id="lobby-time-badge" class="time-badge hidden">60s</span>
                </div>
                
                <!-- Theme Voting Section -->
                <div id="theme-voting-section" class="theme-voting-section">
                    <h3>SELECT DATABASE</h3>
                    <div id="theme-vote-options" class="theme-vote-options">
                        <!-- Theme options with vote counts and voter names -->
                    </div>
                </div>
                
                <div class="players-list" id="lobby-players">
                    <!-- Players will be added here -->
                </div>
                <div class="lobby-info">
                    <p>Operatives: <span id="player-count">0</span>/6</p>
                    <p class="min-players">Minimum 2 operatives required</p>
                </div>
                <div id="host-controls" class="host-controls hidden">
                    <button id="start-game-btn" class="btn btn-primary btn-large btn-block" disabled>&gt; SELECT_WORDS</button>
                </div>
                <button id="leave-lobby-btn" class="btn btn-ghost">&lt; DISCONNECT</button>
            </div>
        </div>

        <!-- Singleplayer Lobby Screen -->
        <div id="singleplayer-lobby-screen" class="screen">
            <div class="card">
                <h2>// SOLO_MISSION</h2>
                <div class="sp-theme-display">
                    <span>DATABASE:</span>
                    <span id="sp-theme-name" class="theme-name">Loading...</span>
                </div>

                <div id="sp-theme-voting-section" class="theme-voting-section">
                    <h3>SELECT DATABASE</h3>
                    <div id="sp-theme-vote-options" class="theme-vote-options">
                        <!-- Theme options -->
                    </div>
                </div>
                
                <div class="sp-players-section">
                    <h3>OPERATIVES</h3>
                    <div id="sp-players-list" class="sp-players-list">
                        <!-- Player and AI slots will be added here -->
                    </div>
                </div>
                
                <div class="sp-ai-controls">
                    <h3>ADD AI OPPONENT</h3>
                    <div class="ai-difficulty-buttons">
                        <button class="btn btn-ai-add" data-difficulty="rookie" title="Wears a wire, drops a clue.">
                            <span class="ai-icon">ü§ñ</span>
                            <span class="ai-label">ROOKIE</span>
                            <span class="ai-desc">Wears a wire, drops a clue.</span>
                        </button>
                        <button class="btn btn-ai-add" data-difficulty="analyst" title="Careful scans. Minimal self-leak.">
                            <span class="ai-icon">ü§ñ</span>
                            <span class="ai-label">ANALYST</span>
                            <span class="ai-desc">Careful scans. Minimal self-leak.</span>
                        </button>
                        <button class="btn btn-ai-add" data-difficulty="field-agent" title="Balanced ops: probes, then strikes.">
                            <span class="ai-icon">ü§ñ</span>
                            <span class="ai-label">FIELD AGENT</span>
                            <span class="ai-desc">Balanced ops: probes, then strikes.</span>
                        </button>
                        <button class="btn btn-ai-add" data-difficulty="spymaster" title="Builds a profile. Executes cleanly.">
                            <span class="ai-icon">ü§ñ</span>
                            <span class="ai-label">SPYMASTER</span>
                            <span class="ai-desc">Builds a profile. Executes cleanly.</span>
                        </button>
                        <button class="btn btn-ai-add" data-difficulty="ghost" title="Leaves no trace. Panics into offense.">
                            <span class="ai-icon">ü§ñ</span>
                            <span class="ai-label">GHOST</span>
                            <span class="ai-desc">Leaves no trace. Panics into offense.</span>
                        </button>
                        <button class="btn btn-ai-add btn-ai-nemesis" data-difficulty="nemesis" title="Cold. Calculated. Relentless.">
                            <span class="ai-icon">ü§ñ</span>
                            <span class="ai-label">NEMESIS</span>
                            <span class="ai-desc">Cold. Calculated. Relentless.</span>
                        </button>
                    </div>
                </div>
                
                <div class="sp-lobby-info">
                    <p>Operatives: <span id="sp-player-count">1</span>/6</p>
                    <p id="sp-min-players" class="min-players">Add at least 1 AI opponent</p>
                </div>
                
                <div class="sp-host-controls">
                    <button id="sp-start-game-btn" class="btn btn-primary btn-large" disabled>&gt; START_MISSION</button>
                </div>
                <button id="sp-leave-lobby-btn" class="btn btn-ghost">&lt; SAVE &amp; EXIT</button>
            </div>
        </div>

        <!-- Word Selection Screen -->
        <div id="wordselect-screen" class="screen">
            <div class="card word-select-card">
                <h2>// SELECT_CODEWORD</h2>
                <p class="theme-label">DATABASE: <span id="wordselect-theme-name">-</span></p>
                
                <div id="word-selection-timer" class="word-selection-timer hidden">‚è± 0:00</div>
                
                <div class="word-select-status">
                    <p id="word-select-status-text">Locked in: <span id="locked-count">0</span>/<span id="total-count">0</span></p>
                    <div id="player-status-list" class="player-status-list">
                        <!-- Player status will be shown here -->
                    </div>
                </div>
                
                <div id="word-select-pool" class="word-select-pool">
                    <!-- Word options will be shown here -->
                </div>
                
                <div id="word-select-controls" class="word-select-controls">
                    <span id="selected-word-display" class="selected-word-display">Click a word above</span>
                    <button id="lock-word-btn" class="btn btn-primary">&gt; LOCK_IN</button>
                </div>
                
                <div id="word-locked-notice" class="word-locked-notice hidden">
                    <p>‚úì CODEWORD LOCKED: <span id="locked-word-display">-</span></p>
                    <p id="waiting-text" class="waiting-text">Waiting for other operatives...</p>
                </div>
                
                <div id="host-begin-controls" class="host-begin-controls hidden">
                    <button id="begin-game-btn" class="btn btn-primary btn-large" disabled>&gt; INITIATE_BREACH</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-layout">
                <!-- Sidebar with word list -->
                <aside class="game-sidebar">
                    <div class="sidebar-header">
                        <h3>DATABASE: <span id="game-theme-name">-</span></h3>
                    </div>
                    <div class="sidebar-legend">
                        <span class="legend-item"><span class="dot guessed"></span> Scanned</span>
                        <span class="legend-item"><span class="dot eliminated"></span> Breached</span>
                    </div>
                    <div class="sidebar-meta">
                        <div class="meta-row"><span>MODE</span><span id="game-mode-badge" class="mode-badge casual">CASUAL</span></div>
                        <div class="meta-row"><span>TURN</span><span id="turn-number">-</span></div>
                        <div class="meta-row"><span>SPECTATORS</span><span id="spectator-count">0</span></div>
                    </div>
                    <div id="game-wordlist" class="game-wordlist-sidebar">
                        <!-- All theme words for reference -->
                    </div>
                </aside>

                <!-- Main game area -->
                <main class="game-main">
                    <div class="game-header">
                        <div class="your-word">
                            <span>YOUR CODEWORD:</span>
                            <span id="your-secret-word" class="secret">???</span>
                        </div>
                        <button id="leave-game-btn" class="btn btn-ghost btn-small leave-game-btn">LEAVE GAME</button>
                    </div>
                    
                    <div id="change-word-container" class="change-word-container hidden">
                        <div class="change-word-header">
                            <p class="change-word-label">üéØ YOU ELIMINATED SOMEONE! PICK A NEW SECRET WORD:</p>
                            <div id="word-change-timer" class="word-change-timer hidden">
                                <span id="word-change-countdown">30</span>s
                            </div>
                        </div>
                        <div id="word-pool-options" class="word-pool-options">
                            <!-- Available words will be shown here -->
                        </div>
                        <div class="change-word-input-row">
                            <span id="new-word-display" class="selected-word-display">üëÜ Click a word above to select it</span>
                            <button id="change-word-btn" class="btn btn-small btn-accent">CONFIRM NEW WORD</button>
                            <button id="skip-word-change-btn" class="btn btn-small btn-ghost">KEEP CURRENT</button>
                        </div>
                    </div>
                    
                    <div id="waiting-for-change" class="waiting-notice hidden">
                        ‚è≥ <span id="waiting-player-name">Operative</span> is picking a new secret word...
                    </div>

                    <!-- Mobile-only docked tabs (WORDS / LOG) -->
                    <div class="game-mobile-tabs" id="game-mobile-tabs" role="tablist" aria-label="Game panels">
                        <button
                            type="button"
                            class="game-mobile-tab active"
                            id="game-mobile-tab-words"
                            role="tab"
                            aria-selected="true"
                            aria-controls="mobile-words-panel"
                        >WORDS</button>
                        <button
                            type="button"
                            class="game-mobile-tab"
                            id="game-mobile-tab-log"
                            role="tab"
                            aria-selected="false"
                            aria-controls="mobile-log-panel"
                        >LOG</button>
                    </div>
                    <div class="game-mobile-panels" id="game-mobile-panels">
                        <div id="mobile-words-panel" class="game-mobile-panel" role="tabpanel" aria-labelledby="game-mobile-tab-words"></div>
                        <div id="mobile-log-panel" class="game-mobile-panel hidden" role="tabpanel" aria-labelledby="game-mobile-tab-log"></div>
                    </div>

                    <div class="players-grid" id="players-grid">
                        <!-- Player cards will be added here -->
                    </div>

                    <div class="turn-indicator" id="turn-indicator">
                        <span id="turn-text">STANDBY...</span>
                        <span id="turn-timer" class="turn-timer hidden">--</span>
                    </div>

                    <div class="guess-section" id="guess-section">
                        <form id="guess-form">
                            <input type="text" id="guess-input" placeholder="Enter probe query..." maxlength="30">
                            <button type="submit" class="btn btn-primary">&gt; TRANSMIT</button>
                        </form>
                    </div>
                </main>

                <!-- Transmission log (desktop right column / tablet below) -->
                <aside class="game-log" aria-label="Transmission log">
                    <div id="game-log-host">
                        <div id="history-section" class="history-section">
                            <h3>// TRANSMISSION_LOG</h3>
                            <div id="history-log" class="history-log">
                                <!-- History entries will be added here -->
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameover-screen" class="screen">
            <div id="confetti-container" class="confetti-container"></div>
            <div class="card gameover-card">
                <div class="trophy-icon" id="trophy-icon">‚óà</div>
                <h2 id="gameover-title">MISSION COMPLETE</h2>
                <p id="gameover-message"></p>
                
                <!-- MMR Change Display (Ranked Games Only) -->
                <div id="mmr-change-widget" class="mmr-change-widget hidden">
                    <div class="mmr-change-header">
                        <span class="mmr-label">RANK PROGRESS</span>
                        <span id="mmr-tier-badge" class="mmr-tier-badge"></span>
                    </div>
                    <div class="mmr-bar-container">
                        <div class="mmr-bar-track">
                            <div class="mmr-bar-tiers">
                                <div class="mmr-tier-segment bronze" data-tier="Bronze"></div>
                                <div class="mmr-tier-segment silver" data-tier="Silver"></div>
                                <div class="mmr-tier-segment gold" data-tier="Gold"></div>
                                <div class="mmr-tier-segment platinum" data-tier="Platinum"></div>
                                <div class="mmr-tier-segment diamond" data-tier="Diamond"></div>
                                <div class="mmr-tier-segment master" data-tier="Master"></div>
                            </div>
                            <div id="mmr-bar-fill" class="mmr-bar-fill"></div>
                            <div id="mmr-bar-marker" class="mmr-bar-marker"></div>
                        </div>
                        <div class="mmr-bar-labels">
                            <span>0</span>
                            <span>500</span>
                            <span>1000</span>
                            <span>1500</span>
                            <span>2000</span>
                            <span>2500</span>
                            <span>3000+</span>
                        </div>
                    </div>
                    <div class="mmr-value-display">
                        <span id="mmr-value-current" class="mmr-value-current">1000</span>
                        <span id="mmr-delta-float" class="mmr-delta-float"></span>
                    </div>
                    <div id="rank-up-banner" class="rank-up-banner hidden">
                        <span class="rank-up-text">RANK UP!</span>
                        <span id="rank-up-tier" class="rank-up-tier"></span>
                    </div>
                </div>
                
                <div class="revealed-words" id="revealed-words">
                    <!-- All secret words revealed -->
                </div>
                
                <!-- Share Results Section -->
                <div class="share-results-section">
                    <h3 class="share-title">// SHARE_RESULTS</h3>
                    <div id="share-preview" class="share-preview">
                        <!-- Generated share text preview -->
                    </div>
                    <div class="share-buttons">
                        <button id="copy-results-btn" class="btn btn-secondary btn-small">üìã COPY</button>
                        <button id="share-twitter-btn" class="btn btn-secondary btn-small">ùïè SHARE</button>
                    </div>
                    <div class="share-buttons" style="margin-top: 0.75rem;">
                        <button id="watch-replay-btn" class="btn btn-secondary btn-small">üé¨ WATCH REPLAY</button>
                        <button id="share-replay-btn" class="btn btn-secondary btn-small">üîó SHARE REPLAY</button>
                    </div>
                </div>
                
                <!-- Support Prompt (shown for non-donors after 3+ games) -->
                <div id="gameover-support-prompt" class="gameover-support-prompt hidden">
                    <p>‚òï Enjoying Embeddle? Your support keeps it free!</p>
                    <a href="https://ko-fi.com/embeddle" target="_blank" rel="noopener" class="btn btn-small btn-support">Support on Ko-fi</a>
                    <button id="dismiss-support-prompt" class="btn btn-ghost btn-tiny" title="Dismiss">√ó</button>
                </div>
                
                <div class="gameover-buttons">
                    <button id="back-to-lobby-btn" class="btn btn-primary">&gt; RETURN_TO_BASE</button>
                </div>
            </div>
        </div>

        <!-- Replay Screen (Full Screen Viewer) -->
        <div id="replay-screen" class="screen replay-screen">
            <div class="replay-layout">
                <!-- Replay Header -->
                <div class="replay-screen-header">
                    <div class="replay-title-section">
                        <h2>üé¨ REPLAY VIEWER</h2>
                        <span id="replay-screen-theme" class="replay-screen-theme">Theme: ‚Äî</span>
                    </div>
                    <button id="replay-back-btn" class="btn btn-ghost btn-small">‚Üê BACK</button>
                </div>

                <!-- Main Replay Content -->
                <div class="replay-main">
                    <!-- Player Cards Grid -->
                    <div id="replay-screen-players" class="replay-screen-players">
                        <!-- Player cards will be rendered here -->
                    </div>

                    <!-- Current Turn Display -->
                    <div class="replay-screen-turn-display">
                        <div id="replay-screen-turn-counter" class="replay-screen-turn-counter">Turn 0 / 0</div>
                        <div id="replay-screen-current-turn" class="replay-screen-current-turn">
                            <div class="replay-turn-info">Game start</div>
                        </div>
                    </div>

                    <!-- Playback Controls -->
                    <div class="replay-screen-controls">
                        <button id="replay-screen-prev" class="btn btn-secondary btn-small">‚èÆ PREV</button>
                        <button id="replay-screen-play" class="btn btn-primary">‚ñ∂ PLAY</button>
                        <button id="replay-screen-next" class="btn btn-secondary btn-small">NEXT ‚è≠</button>
                    </div>

                    <!-- Timeline Slider -->
                    <div class="replay-screen-timeline">
                        <input type="range" id="replay-screen-slider" min="0" max="0" value="0">
                    </div>
                </div>

                <!-- Share Section -->
                <div class="replay-share-section">
                    <h3>// SHARE_REPLAY</h3>
                    <div class="replay-share-buttons">
                        <button id="replay-copy-link-btn" class="btn btn-secondary btn-small">üîó COPY LINK</button>
                        <button id="replay-copy-code-btn" class="btn btn-secondary btn-small">üìã COPY CODE</button>
                    </div>
                    <div class="replay-load-section">
                        <input type="text" id="replay-load-input" placeholder="Paste replay code..." class="replay-code-input">
                        <button id="replay-load-btn" class="btn btn-small btn-secondary">LOAD</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Replay Modal -->
        <div id="replay-modal" class="modal-overlay">
            <div class="modal replay-modal">
                <div class="replay-header">
                    <h2>üé¨ GAME REPLAY</h2>
                    <button id="close-replay-btn" class="btn btn-ghost btn-tiny">√ó</button>
                </div>
                <div class="replay-info">
                    <span id="replay-theme" class="replay-theme"></span>
                    <span id="replay-turn-counter" class="replay-turn-counter">Turn 0/0</span>
                </div>
                <div id="replay-players" class="replay-players">
                    <!-- Player cards will be inserted here -->
                </div>
                <div id="replay-current-turn" class="replay-current-turn">
                    <!-- Current turn info -->
                </div>
                <div class="replay-controls">
                    <button id="replay-prev" class="btn btn-secondary btn-small">‚èÆ PREV</button>
                    <button id="replay-play" class="btn btn-primary btn-small">‚ñ∂ PLAY</button>
                    <button id="replay-next" class="btn btn-secondary btn-small">NEXT ‚è≠</button>
                </div>
                <div class="replay-timeline">
                    <input type="range" id="replay-slider" min="0" max="0" value="0">
                </div>
            </div>
        </div>

        <!-- Footer with Support Links -->
        <footer class="site-footer">
            <div class="footer-content">
                <span class="footer-text">// EMBEDDLE v1.0</span>
                <div class="footer-links">
                    <a href="https://ko-fi.com/embeddle" target="_blank" rel="noopener" class="footer-link support-link">
                        ‚òï Support Development
                    </a>
                    <a href="/privacy" class="footer-link">Privacy</a>
                    <a href="/terms" class="footer-link">Terms</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Custom Lobby Modal -->
    <div id="custom-lobby-modal" class="modal-overlay closable-modal">
        <div class="modal-backdrop" data-close="true"></div>
        <div class="modal custom-lobby-modal">
            <div class="modal-header">
                <h2>// CREATE_CUSTOM_LOBBY</h2>
                <button id="close-custom-lobby-btn" class="btn btn-ghost btn-tiny">√ó</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label>VISIBILITY</label>
                    <div class="visibility-toggle">
                        <button type="button" id="visibility-public" class="visibility-btn active" data-value="public">PUBLIC</button>
                        <button type="button" id="visibility-private" class="visibility-btn" data-value="private">PRIVATE</button>
                    </div>
                    <p class="form-hint" id="visibility-hint">Anyone can join from Active Servers</p>
                </div>
                <div class="form-group">
                    <label for="custom-time-control">TIME CONTROL</label>
                    <select id="custom-time-control" class="time-control-select">
                        <option value="bullet">Bullet (1 min + 5s)</option>
                        <option value="blitz">Blitz (2 min + 10s)</option>
                        <option value="rapid" selected>Rapid (5 min + 15s)</option>
                        <option value="classical">Classical (10 min + 30s)</option>
                        <option value="none">No Limit</option>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button id="create-custom-lobby-confirm" class="btn btn-primary">&gt; CREATE_LOBBY</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Leave Game Modal -->
    <div id="leave-game-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="leave-game-title">
        <div class="modal-backdrop" data-close="true"></div>
        <div class="modal-card">
            <h2 id="leave-game-title">// LEAVE_GAME</h2>
            <p class="modal-text">Are you sure? Leaving will forfeit your current match.</p>
            <div class="button-group">
                <button id="leave-game-exit" class="btn btn-primary">&gt; EXIT</button>
                <button id="leave-game-confirm" class="btn btn-danger">&gt; FORFEIT</button>
                <button id="leave-game-cancel" class="btn btn-secondary">CANCEL</button>
            </div>
        </div>
    </div>

    <!-- Username Setup Modal -->
    <div id="username-modal" class="modal-overlay" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal username-modal">
            <div class="username-modal-header">
                <h2>üéñÔ∏è CHOOSE YOUR CALLSIGN</h2>
            </div>
            <div class="username-modal-content">
                <p class="username-modal-description">Pick a unique callsign for your operative profile. This will be displayed to other players instead of your Google account name.</p>
                <div class="username-input-group">
                    <input type="text" id="username-input" placeholder="Enter callsign..." maxlength="20" autocomplete="off" spellcheck="false">
                    <span id="username-char-count" class="username-char-count">0/20</span>
                </div>
                <p id="username-error" class="username-error hidden"></p>
                <p class="username-rules">3-20 characters. Letters, numbers, underscores, and hyphens only.</p>
                <div class="username-modal-buttons">
                    <button id="username-submit-btn" class="btn btn-primary" disabled>&gt; CONFIRM CALLSIGN</button>
                    <button id="username-skip-btn" class="btn btn-ghost btn-small">Skip for now</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/cosmetics.js"></script>
    <script src="/daily.js"></script>
    <script src="/app.js"></script>
</body>
</html>
